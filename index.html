<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>QA Work Tracker</title>

  <!-- Tailwind config: gunakan dark mode berbasis class -->
  <script>
    window.tailwind = window.tailwind || {};
    tailwind.config = { darkMode: 'class' };
    // Set initial theme sebelum render untuk menghindari FOUC
    (function () {
      const saved = localStorage.getItem('qa_theme');
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = saved || (prefersDark ? 'dark' : 'light');
      if (theme === 'dark') document.documentElement.classList.add('dark');
    })();
  </script>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* Tweaks non-Tailwind */
    .sticky-th th { position: sticky; top: 0; z-index: 1; }
    .scrollbar-thin::-webkit-scrollbar { height: 6px; width: 6px; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 100px; }
    .modal { display:none; }
    .modal.show { display:block; }
    .skeleton { animation: pulse 1.2s infinite; }
    @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }
  </style>
</head>

<body class="bg-slate-50 text-slate-800 dark:bg-slate-900 dark:text-slate-200 min-h-screen">
  <div class="app-container max-w-[1200px] mx-auto px-4 py-6">
    <!-- Top Bar -->
    <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-2xl bg-indigo-600/15 border border-indigo-600/30 flex items-center justify-center">üß™</div>
        <h1 class="text-2xl md:text-3xl font-bold tracking-tight">QA Work Tracker</h1>
      </div>
      <div class="flex items-center flex-wrap gap-2">
        <button id="btnTable" class="px-3 py-2 rounded-xl bg-slate-100 hover:bg-slate-200 border border-slate-300 dark:bg-slate-800 dark:hover:bg-slate-700 dark:border-slate-700" aria-label="Switch to Table View">Table</button>
        <button id="btnKanban" class="px-3 py-2 rounded-xl bg-slate-100 hover:bg-slate-200 border border-slate-300 dark:bg-slate-800 dark:hover:bg-slate-700 dark:border-slate-700" aria-label="Switch to Kanban View">Kanban</button>
        <button id="btnNewTask" class="px-3 py-2 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white" aria-label="New Task">New Task</button>
        <button id="btnExport" class="px-3 py-2 rounded-xl bg-slate-100 hover:bg-slate-200 border border-slate-300 dark:bg-slate-800 dark:hover:bg-slate-700 dark:border-slate-700" aria-label="Export CSV">Export CSV</button>
        <!-- Theme toggle -->
        <button id="btnTheme" class="px-3 py-2 rounded-xl bg-slate-100 hover:bg-slate-200 border border-slate-300 dark:bg-slate-800 dark:hover:bg-slate-700 dark:border-slate-700" aria-label="Toggle theme">
          <span id="iconSun" class="hidden">‚òÄÔ∏è</span>
          <span id="iconMoon">üåô</span>
        </button>
      </div>
    </div>

    <!-- Filters / Search -->
    <div class="mt-6 grid grid-cols-1 md:grid-cols-12 gap-3">
      <div class="md:col-span-4">
        <input id="searchInput" type="text" placeholder="Search title, description, assignee, tags‚Ä¶" class="w-full px-3 py-2 rounded-xl bg-white border border-slate-300 focus:outline-none focus:ring focus:ring-indigo-500 dark:bg-slate-900 dark:border-slate-700"/>
      </div>
      <div class="md:col-span-2">
        <select id="statusFilter" class="w-full px-3 py-2 rounded-xl bg-white border border-slate-300 dark:bg-slate-900 dark:border-slate-700">
          <option value="">All Status</option>
          <option>Backlog</option>
          <option>To Do</option>
          <option>In Progress</option>
          <option>In Review</option>
          <option>Blocked</option>
          <option>Done</option>
        </select>
      </div>
      <div class="md:col-span-2">
        <select id="priorityFilter" class="w-full px-3 py-2 rounded-xl bg-white border border-slate-300 dark:bg-slate-900 dark:border-slate-700">
          <option value="">All Priority</option>
          <option>Low</option>
          <option>Medium</option>
          <option>High</option>
          <option>Critical</option>
        </select>
      </div>
      <div class="md:col-span-2">
        <input id="dueFrom" type="date" class="w-full px-3 py-2 rounded-xl bg-white border border-slate-300 dark:bg-slate-900 dark:border-slate-700" placeholder="Due from"/>
      </div>
      <div class="md:col-span-2">
        <input id="dueTo" type="date" class="w-full px-3 py-2 rounded-xl bg-white border border-slate-300 dark:bg-slate-900 dark:border-slate-700" placeholder="Due to"/>
      </div>
    </div>

    <!-- Summary Cards -->
    <div id="summaryCards" class="mt-6 grid grid-cols-2 md:grid-cols-6 gap-3"></div>

    <!-- Table View -->
    <div id="tableView" class="mt-6 rounded-2xl border border-slate-200 bg-white overflow-hidden dark:bg-slate-950 dark:border-slate-800">
      <div class="overflow-auto scrollbar-thin">
        <table class="min-w-full text-sm">
          <thead class="sticky-th bg-slate-100 text-slate-600 dark:bg-slate-900 dark:text-slate-300">
            <tr>
              <th data-sort="ID" class="px-4 py-3 text-left cursor-pointer">ID</th>
              <th data-sort="Title" class="px-4 py-3 text-left cursor-pointer">Title</th>
              <th data-sort="Assignee" class="px-4 py-3 text-left cursor-pointer">Assignee</th>
              <th data-sort="Priority" class="px-4 py-3 text-left cursor-pointer">Priority</th>
              <th data-sort="Status" class="px-4 py-3 text-left cursor-pointer">Status</th>
              <th data-sort="DueDate" class="px-4 py-3 text-left cursor-pointer">Due</th>
              <th class="px-4 py-3 text-left">Tags</th>
              <th class="px-4 py-3 text-left">Actions</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
      <div class="flex items-center justify-between p-3 border-t border-slate-200 dark:border-slate-800">
        <div class="text-xs text-slate-500 dark:text-slate-400" id="paginationInfo"></div>
        <div class="flex items-center gap-2">
          <button id="prevPage" class="px-3 py-1 rounded-lg bg-slate-100 hover:bg-slate-200 border border-slate-300 dark:bg-slate-800 dark:hover:bg-slate-700 dark:border-slate-700">Prev</button>
          <button id="nextPage" class="px-3 py-1 rounded-lg bg-slate-100 hover:bg-slate-200 border border-slate-300 dark:bg-slate-800 dark:hover:bg-slate-700 dark:border-slate-700">Next</button>
          <select id="pageSize" class="px-2 py-1 rounded-lg bg-white border border-slate-300 dark:bg-slate-900 dark:border-slate-700">
            <option>20</option><option>50</option><option>100</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Kanban View -->
    <div id="kanbanView" class="mt-6 hidden">
      <div class="flex gap-3 overflow-auto pb-2 scrollbar-thin">
        <!-- Columns generated here -->
      </div>
    </div>

  </div>

  <!-- Modal: Create/Edit Task -->
  <div id="taskModal" class="modal fixed inset-0 bg-black/60 z-50">
    <div class="mx-auto my-10 max-w-3xl bg-white dark:bg-slate-950 rounded-2xl border border-slate-200 dark:border-slate-800 overflow-hidden">
      <div class="flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-800">
        <h2 id="modalTitle" class="text-lg font-semibold">New Task</h2>
        <button id="closeModal" class="px-2 py-1 rounded-lg bg-slate-100 hover:bg-slate-200 border border-slate-300 dark:bg-slate-800 dark:hover:bg-slate-700 dark:border-slate-700" aria-label="Close">‚úï</button>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-4">
        <div>
          <label class="text-sm text-slate-500 dark:text-slate-400">Title</label>
          <input id="fTitle" class="w-full px-3 py-2 rounded-xl bg-white border border-slate-300 dark:bg-slate-900 dark:border-slate-700"/>
        </div>
        <div>
          <label class="text-sm text-slate-500 dark:text-slate-400">Assignee</label>
          <input id="fAssignee" class="w-full px-3 py-2 rounded-xl bg-white border border-slate-300 dark:bg-slate-900 dark:border-slate-700"/>
        </div>
        <div class="md:col-span-2">
          <label class="text-sm text-slate-500 dark:text-slate-400">Description</label>
          <textarea id="fDescription" rows="4" class="w-full px-3 py-2 rounded-xl bg-white border border-slate-300 dark:bg-slate-900 dark:border-slate-700"></textarea>
        </div>
        <div>
          <label class="text-sm text-slate-500 dark:text-slate-400">Priority</label>
          <select id="fPriority" class="w-full px-3 py-2 rounded-xl bg-white border border-slate-300 dark:bg-slate-900 dark:border-slate-700">
            <option>Low</option><option>Medium</option><option>High</option><option>Critical</option>
          </select>
        </div>
        <div>
          <label class="text-sm text-slate-500 dark:text-slate-400">Status</label>
          <select id="fStatus" class="w-full px-3 py-2 rounded-xl bg-white border border-slate-300 dark:bg-slate-900 dark:border-slate-700">
            <option>Backlog</option><option>To Do</option><option>In Progress</option><option>In Review</option><option>Blocked</option><option>Done</option>
          </select>
        </div>
        <div>
          <label class="text-sm text-slate-500 dark:text-slate-400">Due Date</label>
          <input id="fDueDate" type="date" class="w-full px-3 py-2 rounded-xl bg-white border border-slate-300 dark:bg-slate-900 dark:border-slate-700"/>
        </div>
        <div class="md:col-span-2">
          <label class="text-sm text-slate-500 dark:text-slate-400">Tags (comma separated)</label>
          <input id="fTags" class="w-full px-3 py-2 rounded-xl bg-white border border-slate-300 dark:bg-slate-900 dark:border-slate-700"/>
        </div>
        <div class="md:col-span-2">
          <label class="text-sm text-slate-500 dark:text-slate-400">Note (optional)</label>
          <input id="fNote" class="w-full px-3 py-2 rounded-xl bg-white border border-slate-300 dark:bg-slate-900 dark:border-slate-700"/>
        </div>
      </div>
      <div class="px-4 pb-4 flex items-center justify-between gap-2 border-t border-slate-200 dark:border-slate-800">
        <div class="text-xs text-slate-500 dark:text-slate-400 p-3" id="detailMeta"></div>
        <div class="flex gap-2 p-3">
          <button id="btnDelete" class="hidden px-3 py-2 rounded-xl bg-red-600 hover:bg-red-500 text-white">Delete</button>
          <button id="btnSave" class="px-3 py-2 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white">Save</button>
        </div>
      </div>
      <div class="px-4 pb-5">
        <div class="flex items-center gap-4 border-b border-slate-200 dark:border-slate-800 px-1">
          <button id="tabDetails" class="py-2 text-indigo-600 dark:text-indigo-400 border-b-2 border-indigo-500">Details</button>
          <button id="tabHistory" class="py-2 text-slate-500 dark:text-slate-400">History</button>
        </div>
        <div id="historyPanel" class="mt-4 hidden">
          <ul id="historyList" class="space-y-2 text-sm"></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 right-4 z-50 hidden">
    <div class="px-4 py-2 bg-white border border-slate-200 rounded-xl shadow-lg dark:bg-slate-900 dark:border-slate-700"></div>
  </div>

  <script type="module" src="./app.js"></script>
</body>
</html>